<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Car List</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .filter-panel { margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px; }
        .table-responsive { margin-top: 20px; }
        .pagination { justify-content: center; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mt-4">Car List</h1>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>
        <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>

        <a href="/cars/add" class="btn btn-primary mb-3">Add New Car</a>

        <!-- Section 1: Tìm kiếm cơ bản -->
        <div class="filter-panel">
            <h4>Search Cars</h4>
            <form th:action="@{/cars/search}" method="get" class="row g-3">
                <div class="col-md-4">
                    <input type="text" name="keyword" class="form-control" placeholder="Search by Model or Brand" th:value="${keyword}">
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-secondary">Search</button>
                </div>
            </form>
        </div>

        <!-- Section 2: Lọc theo tình trạng -->
        <div class="filter-panel">
            <h4>Filter by Status</h4>
            <form th:action="@{/cars/status}" method="get" class="row g-3">
                <div class="col-md-3">
                    <select name="status" class="form-select">
                        <option value="">All</option>
                        <option th:value="Available" th:selected="${status == 'Available'}">Available</option>
                        <option th:value="Sold" th:selected="${status == 'Sold'}">Sold</option>
                        <option th:value="Reserved" th:selected="${status == 'Reserved'}">Reserved</option>
                        <option th:value="OutOfStock" th:selected="${status == 'OutOfStock'}">Out of Stock</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-secondary">Filter</button>
                </div>
            </form>
        </div>

        <!-- Section 3: Lọc theo số lượng -->
        <div class="filter-panel">
            <h4>Filter by Quantity</h4>
            <form th:action="@{/cars/quantity}" method="get" class="row g-3">
                <div class="col-md-3">
                    <select name="quantityStatus" class="form-select">
                        <option value="">All</option>
                        <option th:value="InStock" th:selected="${quantityStatus == 'InStock'}">In Stock</option>
                        <option th:value="LowStock" th:selected="${quantityStatus == 'LowStock'}">Low Stock</option>
                        <option th:value="OutOfStock" th:selected="${quantityStatus == 'OutOfStock'}">Out of Stock</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-secondary">Filter</button>
                </div>
            </form>
        </div>

        <!-- Bảng danh sách xe -->
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Brand</th>
                        <th>Model</th>
                        <th>Year</th>
                        <th>Price</th>
                        <th>Status</th>
                        <th>Quantity</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="car : ${cars}">
                        <td th:text="${car.carId}"></td>
                        <td th:text="${car.brand}"></td>
                        <td th:text="${car.model}"></td>
                        <td th:text="${car.year}"></td>
                        <td th:text="${#numbers.formatDecimal(car.price, 0, 'COMMA', 2, 'POINT')} + ' VND'"></td>
                        <td th:text="${car.status}"></td>
                        <td th:text="${car.quantity}"></td>
                        <td>
                            <a th:href="@{/cars/edit/{carId}(carId=${car.carId})}" class="btn btn-sm btn-warning">Edit</a> |
                            <a th:href="@{/cars/delete/{carId}(carId=${car.carId})}" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure?')">Delete</a> |
                            <a th:href="@{/cars/detail/{carId}(carId=${car.carId})}" class="btn btn-sm btn-info">Detail</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Phân trang -->
        <nav aria-label="Page navigation">
            <ul class="pagination" th:if="${totalPages > 1}">
                <li class="page-item" th:class="${currentPage == 0} ? 'disabled'">
                    <a class="page-link" th:href="@{/cars/search(page=0, size=${size}, keyword=${keyword}, brand=${brand})}">First</a>
                </li>
                <!-- Thêm các nút Previous, Next, Last tương tự -->
            </ul>
        </nav>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>